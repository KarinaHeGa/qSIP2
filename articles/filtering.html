<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Filtering Features • qSIP2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filtering Features">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">qSIP2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.19.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/qSIP_workflow.html">Standard qSIP EAF Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/filtering.html">Filtering Features</a></li>
    <li><a class="dropdown-item" href="../articles/resampling.html">Resampling</a></li>
    <li><a class="dropdown-item" href="../articles/EAF.html">EAF Calculations</a></li>
    <li><a class="dropdown-item" href="../articles/growth.html">Growth Workflow</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jeffkimbrel/qSIP2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Filtering Features</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jeffkimbrel/qSIP2/blob/master/vignettes/filtering.Rmd" class="external-link"><code>vignettes/filtering.Rmd</code></a></small>
      <div class="d-none name"><code>filtering.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jeffkimbrel/qSIP2" class="external-link">qSIP2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"qSIP2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] '0.19.2'</span></span></code></pre></div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>After a qsip_data object is built and validated, the first step in
the analysis is to filter the features using
<code><a href="../reference/run_feature_filter.html">run_feature_filter()</a></code>. This is done to narrow down the
sources for a specific comparison, and remove features that are not
useful for the analysis. Filtering has three sequential steps.</p>
<ul>
<li>identify relevant unlabeled and labeled <code>source_mat_id</code>
values for the comparison</li>
<li>score specific features considered as “present” in a source by using
fraction count thresholds</li>
<li>remove features that are not present in enough sources</li>
</ul>
<p>Each step is detailed in the following sections.</p>
</div>
<div class="section level2">
<h2 id="define-the-sources-for-a-comparison">Define the sources for a comparison<a class="anchor" aria-label="anchor" href="#define-the-sources-for-a-comparison"></a>
</h2>
<p>The first step in filtering is to identify the relevant source_mat_id
values for a specific comparison. The <code><a href="../reference/run_feature_filter.html">run_feature_filter()</a></code>
arguments most important for this step are
<code>unlabeled_source_mat_ids</code> and
<code>labeled_source_mat_ids.</code> These are lists of source_mat_id
values that are used to filter the features. These can be explicitly
stated
(e.g. <code>unlabeled_source_mat_ids = c("source1", "source2")</code>),
or they can be identified by using some key terms that will identify all
sources satisfying that criteria
(e.g. <code>unlabeled_source_mat_ids = "12C"</code> or
<code>labeled_source_mat_ids = "labeled"</code>).</p>
<p>There are internal validations for this step to make sure the sources
provided to a given argument make sense with the isotope designation in
the source data. For example, if you try to give a 13C source to the
<code>unlabeled_source_mat_ids</code> then there will be an error. If
you try to sources with a mixture of heavy istopes (e.g. 13C and 15N) to
the <code>labeled_source_mat_ids</code> then there will be an error.
This can happen either explicitly by providing the wrong source_mat_id
values, or if you have a mixture and choose “labeled” for
<code>labeled_source_mat_ids</code>. Having a mixture of unlabeled
source isotopes (e.g. 12C and 14N), however, is allowed and will not
give an error.</p>
<p>The group argument is optional and provides a place for a description
of that particular comparison
(e.g. <code>group = "7 day drought treatment"</code>).</p>
</div>
<div class="section level2">
<h2 id="score-features-as-present-in-a-source">Score features as “present” in a source<a class="anchor" aria-label="anchor" href="#score-features-as-present-in-a-source"></a>
</h2>
<p>Simplistically, a feature is considered present in a sample if there
are counts for it. Features present in only a few samples, however, can
lead to inaccurate estimates of the weighted average density (WAD) and
should therefore be removed. For example, if a source has 20 sequenced
samples (fractions), each with their own read depths, a feature
appearing in only one sample may be because that sample happened to have
the deepest sequencing. Therefore, it wouldn’t be expected to be an
accurate representation of the true density values. Accordingly, a
feature should be present in at least a few samples (let’s say 3) to
have a more trustworthy WAD value.</p>
<p>The minimum fraction count can be defined differently for the
unlabeled and labeled samples using the
<code>min_unlabeled_fractions</code> and
<code>min_labeled_fractions</code> arguments, respectively. The function
uses these values to define a feature as “present” in a source if it is
found in at least that many samples (fractions).</p>
</div>
<div class="section level2">
<h2 id="remove-features-that-are-not-present-in-enough-sources">Remove features that are not present in enough sources<a class="anchor" aria-label="anchor" href="#remove-features-that-are-not-present-in-enough-sources"></a>
</h2>
<p>The results of the last filtering step are used in this step to make
a final call for a <code>feature_id</code> in that comparison. If a
feature is found in the number of sources defined in
<code>min_unlabeled_sources</code> and <code>min_labeled_sources</code>,
then it will survive the filtering step and move on to resampling/EAF
calculations.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>As detailed in the main vignette, we can use the
<code><a href="../reference/show_comparison_groups.html">show_comparison_groups()</a></code> function to see the available
comparisons (this is just a prediction though!). We can run a few with
the test dataset (<code>example_qsip_object</code>) and see how the text
result changes to allow less through as we get more restrictive.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">restrictive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_feature_filter.html">run_feature_filter</a></span><span class="op">(</span><span class="va">example_qsip_object</span>,</span>
<span>  unlabeled_source_mat_ids <span class="op">=</span> <span class="fu"><a href="../reference/get_all_by_isotope.html">get_all_by_isotope</a></span><span class="op">(</span><span class="va">example_qsip_object</span>, <span class="st">"12C"</span><span class="op">)</span>,</span>
<span>  labeled_source_mat_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S178"</span>, <span class="st">"S179"</span>, <span class="st">"S180"</span><span class="op">)</span>,</span>
<span>  min_unlabeled_sources <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  min_labeled_sources <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  min_unlabeled_fractions <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  min_labeled_fractions <span class="op">=</span> <span class="fl">6</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; There are initially 2030 unique feature_ids</span></span>
<span><span class="co">#&gt; 1705 of these have abundance in at least one fraction of one source_mat_id</span></span>
<span><span class="co">#&gt; =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span></span>
<span><span class="co">#&gt; Filtering feature_ids by fraction...</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">1519</span> unlabeled and <span style="color: #BB0000;">1417</span> labeled feature_ids were found in <span style="color: #BB0000;">zero fractions</span> in at least one source_mat_id</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">1440</span> unlabeled and <span style="color: #BB0000;">830</span> labeled feature_ids were found in <span style="color: #BB0000;">too few fractions</span> in at least one source_mat_id</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">299</span> unlabeled and <span style="color: #00BB00;">209</span> labeled feature_ids <span style="color: #00BB00;">passed</span> the fraction filter</span></span>
<span><span class="co">#&gt; In total, <span style="color: #00BB00;">346</span> unique feature_ids <span style="color: #00BB00;">passed</span> the fraction filtering requirements...</span></span>
<span><span class="co">#&gt; =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span></span>
<span><span class="co">#&gt; Filtering feature_ids by source...</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">47</span> unlabeled and <span style="color: #BB0000;">137</span> labeled feature_ids failed the source filter because they were found in <span style="color: #BB0000;">zero sources</span></span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">196</span> unlabeled and <span style="color: #BB0000;">127</span> labeled feature_ids failed the source filter because they were found in <span style="color: #BB0000;">too few sources</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">103</span> unlabeled and <span style="color: #00BB00;">82</span> labeled feature_ids <span style="color: #00BB00;">passed</span> the source filter</span></span>
<span><span class="co">#&gt; =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span></span>
<span><span class="co">#&gt; In total, <span style="color: #00BB00;">64</span> unique feature_ids <span style="color: #00BB00;">passed</span> all fraction and source filtering requirements</span></span>
<span></span>
<span><span class="va">loose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_feature_filter.html">run_feature_filter</a></span><span class="op">(</span><span class="va">example_qsip_object</span>,</span>
<span>  unlabeled_source_mat_ids <span class="op">=</span> <span class="fu"><a href="../reference/get_all_by_isotope.html">get_all_by_isotope</a></span><span class="op">(</span><span class="va">example_qsip_object</span>, <span class="st">"12C"</span><span class="op">)</span>,</span>
<span>  labeled_source_mat_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S178"</span>, <span class="st">"S179"</span>, <span class="st">"S180"</span><span class="op">)</span>,</span>
<span>  min_unlabeled_sources <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  min_labeled_sources <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  min_unlabeled_fractions <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  min_labeled_fractions <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; There are initially 2030 unique feature_ids</span></span>
<span><span class="co">#&gt; 1705 of these have abundance in at least one fraction of one source_mat_id</span></span>
<span><span class="co">#&gt; =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span></span>
<span><span class="co">#&gt; Filtering feature_ids by fraction...</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">1519</span> unlabeled and <span style="color: #BB0000;">1417</span> labeled feature_ids were found in <span style="color: #BB0000;">zero fractions</span> in at least one source_mat_id</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">1210</span> unlabeled and <span style="color: #BB0000;">584</span> labeled feature_ids were found in <span style="color: #BB0000;">too few fractions</span> in at least one source_mat_id</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">780</span> unlabeled and <span style="color: #00BB00;">497</span> labeled feature_ids <span style="color: #00BB00;">passed</span> the fraction filter</span></span>
<span><span class="co">#&gt; In total, <span style="color: #00BB00;">870</span> unique feature_ids <span style="color: #00BB00;">passed</span> the fraction filtering requirements...</span></span>
<span><span class="co">#&gt; =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span></span>
<span><span class="co">#&gt; Filtering feature_ids by source...</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">90</span> unlabeled and <span style="color: #BB0000;">373</span> labeled feature_ids failed the source filter because they were found in <span style="color: #BB0000;">zero sources</span></span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">245</span> unlabeled and <span style="color: #BB0000;">189</span> labeled feature_ids failed the source filter because they were found in <span style="color: #BB0000;">too few sources</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">535</span> unlabeled and <span style="color: #00BB00;">308</span> labeled feature_ids <span style="color: #00BB00;">passed</span> the source filter</span></span>
<span><span class="co">#&gt; =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span></span>
<span><span class="co">#&gt; In total, <span style="color: #00BB00;">257</span> unique feature_ids <span style="color: #00BB00;">passed</span> all fraction and source filtering requirements</span></span></code></pre></div>
<p>So, 64 features pass the more restrictive criteria, but we get 257 by
relaxing the criteria a little bit. The function messages are rather
verbose, but they try to summarize the results of each step.</p>
<div class="alert alert-primary">
<p>Note, relaxing the criteria too much can lead to errors later during
resampling. See <code><a href="../articles/resampling.html">vignette("resampling")</a></code> for more information
or how to use the <code>allow_failures = TRUE</code> argument.</p>
</div>
<p>We can get a list of the features using
<code><a href="../reference/get_feature_ids.html">get_feature_ids()</a></code>, and to restrict it to the post-filtering
results we add the <code>filtered = TRUE</code> argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_feature_ids.html">get_feature_ids</a></span><span class="op">(</span><span class="va">restrictive</span>, filtered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 64</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_feature_ids.html">get_feature_ids</a></span><span class="op">(</span><span class="va">loose</span>, filtered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 257</span></span></code></pre></div>
<div class="section level3">
<h3 id="inspecting-the-results">Inspecting the results<a class="anchor" aria-label="anchor" href="#inspecting-the-results"></a>
</h3>
<p>You can see the “fate” of a specific feature to see why it was or
wasn’t included in the resulting object. First, we can get a few
feature_ids that had different fates between the different filtering
conditions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diff_features</span> <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_feature_ids.html">get_feature_ids</a></span><span class="op">(</span><span class="va">loose</span>, filtered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="../reference/get_feature_ids.html">get_feature_ids</a></span><span class="op">(</span><span class="va">restrictive</span>, filtered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>ASV_100</code> is the first on the list that was present in the
loose filtering, but remove in the restrictive filtering. We can use the
<code><a href="../reference/get_filtered_feature_summary.html">get_filtered_feature_summary()</a></code> function to look at the
filtering parameters affected the fate of <code>ASV_100</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ASV_100_restrictive</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_filtered_feature_summary.html">get_filtered_feature_summary</a></span><span class="op">(</span><span class="va">restrictive</span>, feature_id <span class="op">=</span> <span class="st">"ASV_100"</span><span class="op">)</span></span>
<span><span class="va">ASV_100_loose</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_filtered_feature_summary.html">get_filtered_feature_summary</a></span><span class="op">(</span><span class="va">loose</span>, feature_id <span class="op">=</span> <span class="st">"ASV_100"</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/get_filtered_feature_summary.html">get_filtered_feature_summary()</a></code> function returns a
list with information that summarize the filtering steps for a specific
feature.</p>
<ul>
<li>
<code>$fraction_filter_summary</code> is the sample (fraction) count
results</li>
<li>
<code>$source_filter_summary</code> is the source count results</li>
<li>
<code>$retained</code> is the final boolean call of whether the
feature was retained or not</li>
</ul>
<p>As expected (because we picked <code>ASV_100</code> as an example of
differential filtering), the <code>retained</code> slot is
<code>FALSE</code> for the restrictive filtering and <code>TRUE</code>
for the loose filtering.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ASV_100_loose</span><span class="op">$</span><span class="va">retained</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">ASV_100_restrictive</span><span class="op">$</span><span class="va">retained</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>We can look at the fraction count summary for the feature in the two
filtering conditions in the <code>$fraction_filter_summary</code> slot.
This code combines the two sets of results, but just the last two
columns are of importance.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">ASV_100_restrictive</span><span class="op">$</span><span class="va">fraction_filter_summary</span>,</span>
<span>  <span class="va">ASV_100_loose</span><span class="op">$</span><span class="va">fraction_filter_summary</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"feature_id"</span>, <span class="st">"source_mat_id"</span>, <span class="st">"tube_rel_abundance"</span>, <span class="st">"type"</span>, <span class="st">"n_fractions"</span><span class="op">)</span>,</span>
<span>  suffixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" (restrictive)"</span>, <span class="st">" (loose)"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">source_mat_id</span>, <span class="va">type</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"fraction"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    source_mat_id      type n_fractions fraction_call (restrictive)</span></span>
<span><span class="co">#&gt; 1           S149 unlabeled           3           Fraction Filtered</span></span>
<span><span class="co">#&gt; 2           S150 unlabeled          10             Fraction Passed</span></span>
<span><span class="co">#&gt; 3           S151 unlabeled           7             Fraction Passed</span></span>
<span><span class="co">#&gt; 4           S152 unlabeled           6             Fraction Passed</span></span>
<span><span class="co">#&gt; 5           S161 unlabeled           7             Fraction Passed</span></span>
<span><span class="co">#&gt; 6           S162 unlabeled          13             Fraction Passed</span></span>
<span><span class="co">#&gt; 7           S163 unlabeled           6             Fraction Passed</span></span>
<span><span class="co">#&gt; 8           S164 unlabeled           9             Fraction Passed</span></span>
<span><span class="co">#&gt; 9           S178   labeled           4           Fraction Filtered</span></span>
<span><span class="co">#&gt; 10          S179   labeled           5           Fraction Filtered</span></span>
<span><span class="co">#&gt; 11          S180   labeled           7             Fraction Passed</span></span>
<span><span class="co">#&gt;    fraction_call (loose)</span></span>
<span><span class="co">#&gt; 1        Fraction Passed</span></span>
<span><span class="co">#&gt; 2        Fraction Passed</span></span>
<span><span class="co">#&gt; 3        Fraction Passed</span></span>
<span><span class="co">#&gt; 4        Fraction Passed</span></span>
<span><span class="co">#&gt; 5        Fraction Passed</span></span>
<span><span class="co">#&gt; 6        Fraction Passed</span></span>
<span><span class="co">#&gt; 7        Fraction Passed</span></span>
<span><span class="co">#&gt; 8        Fraction Passed</span></span>
<span><span class="co">#&gt; 9        Fraction Passed</span></span>
<span><span class="co">#&gt; 10       Fraction Passed</span></span>
<span><span class="co">#&gt; 11       Fraction Passed</span></span></code></pre></div>
<p>Above, you can see that in the unlabeled samples, only S149 had a
difference between restrictive and loose, but 2 of the 3 labeled samples
had differences and showed as “Fraction Filtered”.</p>
<p>Therefore, the sample (fraction) count filtering came to different
conclusions…</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">ASV_100_restrictive</span><span class="op">$</span><span class="va">source_filter_summary</span>,</span>
<span>  <span class="va">ASV_100_loose</span><span class="op">$</span><span class="va">source_filter_summary</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"feature_id"</span>, <span class="st">"type"</span><span class="op">)</span>,</span>
<span>  suffixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"_restrictive"</span>, <span class="st">"_loose"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">mean_tube_rel_abundance_restrictive</span>, <span class="op">-</span><span class="va">mean_tube_rel_abundance_loose</span><span class="op">)</span></span>
<span><span class="co">#&gt;   feature_id      type n_sources_restrictive source_call_restrictive</span></span>
<span><span class="co">#&gt; 1    ASV_100   labeled                     1         Source Filtered</span></span>
<span><span class="co">#&gt; 2    ASV_100 unlabeled                     7           Source Passed</span></span>
<span><span class="co">#&gt;   n_sources_loose source_call_loose</span></span>
<span><span class="co">#&gt; 1               3     Source Passed</span></span>
<span><span class="co">#&gt; 2               8     Source Passed</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-the-results">Plotting the results<a class="anchor" aria-label="anchor" href="#plotting-the-results"></a>
</h3>
<p>Although there is a dramatic difference in the number of retained
features between the two conditions, we can see how prevalent the
features that are different are by plotting the fraction count
distributions.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_filter_results.html">plot_filter_results</a></span><span class="op">(</span><span class="va">loose</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Loose"</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">=</span> <span class="fu"><a href="../reference/plot_filter_results.html">plot_filter_results</a></span><span class="op">(</span><span class="va">restrictive</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Restrictive"</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">/</span> <span class="va">b</span></span></code></pre></div>
<p><img src="filtering_files/figure-html/unnamed-chunk-10-1.png" width="768"></p>
<p>In the top plots, the blue is much larger than it is in the bottom
plots, indicating more (obviously) made it through the loose filtering.
But, even though there are 4x more features in the loose dataset, it is
only about a 15-20% increase in terms of the abundance of features in
the original dataset.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jeff Kimbrel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
